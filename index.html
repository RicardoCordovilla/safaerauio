<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=0.9">
    <title>Reservas Safaera</title>
    <link rel="stylesheet" href="estilos.css">
    <link rel="icon" href="logos/isotipo_safaera.png" type="image/x-icon">
    <!-- <script src="https://unpkg.com/jspdf@latest/dist/jspdf.umd.min.js"></script> -->

</head>

<body>
    <header>
        <figure class="figura">
            <img src="logos/safaera_logo.png" alt="" class="logo">
        </figure>
    </header>
    <main>


        <!-- <a href="confirmacion.html">confirmacion</a> -->

        <section>
            <h1>la mejor discoteca de Quito safaera</h1>
        </section>

        <section class="descripcion">
            <p>Vive la mejor experiencia de entretenimiento en Quito</p>
            <p>Av. República y Mañosca, Plaza Mayor</p>
            <p><strong>SEGUNDO PISO</strong></p>
        </section>



        <!-- <script type="text/javascript" src="https://form.jotform.com/jsform/221894112827660"></script> -->




        <!-- *************** RESERVAS  ***************** -->
        <section class="reservas">

            <!-- <form class="form" name="reserva" method="post" data-netlify="true"> -->
            <!-- <form class="form" action="https://formspree.io/f/mqknopbg" method="POST"> -->
            <form class="form" name="Reservas">
                <div class="title">Reserva</div>

                <div class="input-container ic1">
                    <input id="firstname" class="input" type="text" placeholder=" " name="Nombre" required />
                    <div class="cut"></div>
                    <label for="firstname" class="placeholder">Nombre</label>
                </div>




                <div class="input-container ic2">
                    <input id="cedula" class="input" type="number" placeholder=" " name="Cedula" required />
                    <div class="cut"></div>
                    <label for="cedula" class="placeholder">Cédula</label>
                </div>



                <div class="section_cumple">
                    <h4>¿Hay algún cumpleañero?</h4>
                    <input type="checkbox" id="cumple" class="hidebx" name="Cumple" />
                    <label for="cumple" class="lbl-check">
                        <div class="display-box">
                            <span class="tiempo">SI</span>
                        </div>
                    </label>
                </div>



                <div class="input-container ic2">
                    <input id="celular" class="input" type="tel" placeholder=" " name="Celular" required />
                    <div class="cut cut-short"></div>
                    <label for="celular" class="placeholder">Celular</label>
                </div>

                <div class="input-container ic2">
                    <input id="personas" class="input" type="number" placeholder=" " name="Personas" required />
                    <div class="cut cut-short"></div>
                    <label for="personas" class="placeholder">¿Cuántas personas vienen?</label>
                </div>

                <!-- ****** FECHA  *********** -->
                <div class="input-container ic2">
                    <input id="fecha" class="input" type="date" placeholder=" " name="Fecha" required />
                    <div class="cut cut-short"></div>
                    <label for="fecha" class="placeholder">Agenda</label>
                </div>

                <!-- ************************* -->
                <!-- ****** HORAS  *********** -->



                <h4>Hora</h4>
                <div class="container">


                    <!-- 7:00 -->
                    <input type="radio" name="hora" id="hora1" class="hidebx" value="7:00" checked />
                    <label for="hora1" class="lbl-radio">
                        <div class="display-box">
                            <span class="tiempo">19:00</span>
                        </div>
                    </label>

                    <!-- 7:30 -->
                    <input type="radio" name="hora" id="hora2" class="hidebx" value="7:30" />
                    <label for="hora2" class="lbl-radio">
                        <div class="display-box">
                            <span class="tiempo">19:30</span>
                        </div>
                    </label>

                    <!-- 8:00 -->
                    <input type="radio" name="hora" id="hora3" class="hidebx" value="8:00" />
                    <label for="hora3" class="lbl-radio">
                        <div class="display-box">
                            <span class="tiempo">20:00</span>
                        </div>
                    </label>

                    <!-- 8:30 -->
                    <input type="radio" name="hora" id="hora4" class="hidebx" value="8:30" />
                    <label for="hora4" class="lbl-radio">
                        <div class="display-box">
                            <span class="tiempo">20:30</span>
                        </div>
                    </label>


                    <!-- 9:00 -->
                    <input type="radio" name="hora" id="hora5" class="hidebx" value="9:00" />
                    <label for="hora5" class="lbl-radio">
                        <div class="display-box">
                            <span class="tiempo">21:00</span>
                        </div>
                    </label>


                    <!-- 9:30 -->
                    <input type="radio" name="hora" id="hora6" class="hidebx" value="9:30" />
                    <label for="hora6" class="lbl-radio">
                        <div class="display-box">
                            <span class="tiempo">21:30</span>
                        </div>
                    </label>

                    <!-- 10:00 -->
                    <input type="radio" name="hora" id="hora7" class="hidebx" value="10:00" />
                    <label for="hora7" class="lbl-radio">
                        <div class="display-box">
                            <span class="tiempo">22:00</span>
                        </div>
                    </label>

                    <!-- 10:30 -->
                    <input type="radio" name="hora" id="hora8" class="hidebx" value="10:30" />
                    <label for="hora8" class="lbl-radio">
                        <div class="display-box">
                            <span class="tiempo">22:30</span>
                        </div>
                    </label>

                    <!-- 11:00 -->
                    <input type="radio" name="hora" id="hora9" class="hidebx" value="11:00" />
                    <label for="hora9" class="lbl-radio">
                        <div class="display-box">
                            <span class="tiempo">23:00</span>
                        </div>
                    </label>

                    <!-- 11:30 -->
                    <input type="radio" name="hora" id="hora10" class="hidebx" value="11:30" />
                    <label for="hora10" class="lbl-radio">
                        <div class="display-box">
                            <span class="tiempo">23:30</span>
                        </div>
                    </label>



                </div>



                <!-- *************************** -->



                <button type="submit" class="submit" id="btn_enviar">Reservar</button>


            </form>



        </section>
        <!-- *********************************************** -->


        <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/1.5.3/jspdf.debug.js"
            integrity="sha384-NaWTHo/8YCBYJ59830LTz/P4aQZK1sS0SneOgAvhsIl3zBu8r9RevNg5lHCHAuQ/" crossorigin="anonymous">
            </script>
        <script src="./assets/js/jspdf.js">
        </script>
        <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
        <script>
            const weekday = ["Lunes", "Martes", "Miercoles", "Jueves", "Viernes", "Sabado", "Domingo"];
            const getDay = (dateString) => {
                const date = new Date(dateString);
                day = weekday[date.getDay()];
                return day
            }
            const getDateCurrent = () => {
                let date = new Date().toJSON().slice(0, 10)
                return date
            }
            const getDateAvailable = (dateString = "") => {
                if (dateString) {
                    /* Lo que es ubicar la fecha a la mas reciente y no antes, pues no hay eventos apartar en el pasado */
                    let date = new Date(dateString)
                    if (date.getTime() > new Date().getTime())
                        dateString = date.toJSON().slice(0, 10)
                    else
                        dateString = new Date().toJSON().slice(0, 10)
                } else {
                    let date = new Date()
                    dateString = date.toJSON().slice(0, 10)
                }
                let date = dateString ? new Date(dateString) : new Date();
                let day = date.getDay();
                let addDays = 0
                switch (+day) {
                    case 6: /* 'Domingo' */
                        addDays = 4
                        break;
                    case 0: /* 'Lunes' */
                        addDays = 3
                        break;
                    case 1: /* 'Martes' */
                        addDays = 2
                        break;
                    case 2: /* 'Miercoles' */
                        addDays = 1
                        break;
                    default:
                        break;
                }
                date.setDate(date.getDate() + addDays)
                return date.toJSON().slice(0, 10)
            }
            const newForm = (name) => {
                let form = document.createElement('form')
                form.name = name
                return form
            }
            const newInput = (name, value) => {
                const input = document.createElement('input')
                input.name = name
                input.value = value
                return input
            }
            const appendForm = (formSend, props) => {
                console.log('Agregar a ');
                Object.keys(props).forEach(prop => {
                    const input = props[prop]
                    console.log({ n: prop, v: input.value });
                    formSend.append(newInput(prop, input.value))
                })
                return formSend
            }


            const scriptURL = 'https://script.google.com/macros/s/AKfycbwxgM62rxYbekf2wZizihjnbCQp5-KHbQgtXdg9tm42z3Hp7gGxjS45IdxW3wuWill1/exec'
            const form = document.forms['Reservas']
            form.Fecha.value = getDateAvailable()

            form.Fecha.addEventListener('change', (e) => {
                if (e.target == form.Cumple) {

                } else if (e.target == form.Fecha) {
                    switch (getDay(form.Fecha.value)) {
                        case 'Jueves':
                        case 'Viernes':
                        case 'Sabado':
                            break;
                        default:
                            form.fecha.value = getDateAvailable(form.fecha.value)
                            alert('Solo dias Jueves, Viernes y Sabado ')
                            return;
                    }
                }
            })
            form.addEventListener('submit', e => {
                e.preventDefault()
                let formSend = appendForm(
                    newForm(name = "Reservas"),
                    {
                        Nombre: form.Nombre,
                        Cedula: form.Cedula,
                        Cumple: newInput('Cumple', 'NO'),
                        Celular: form.Celular,
                        Personas: form.Personas,
                        Dia: newInput('Dia', getDay(form.Fecha.value)),
                        Fecha: form.Fecha,
                        hora: form.hora
                    }
                )

                form.btn_enviar.disabled = true
                form.btn_enviar.innerHTML = 'Un momento por favor..'

                formSend.Cumple.value = form.Cumple.checked ? 'SI' : 'NO'

                console.log(formSend);
                fetch(scriptURL, { method: 'POST', body: new FormData(formSend) })
                    .then(response => {

                        console.log('Success!', response)

                        form.btn_enviar.innerHTML = 'Gracias'
                        setTimeout(() => {
                            // alert('listo')
                            window.location.href = "./confirmacion.html";
                        }, 100)

                    })

            })

        </script>
        
        <footer>
            &copy; <a href="https://github.com/RicardoCordovilla/RickiDev">Ricardo Cordovilla </a>
        </footer>
    </main>
</body>

</html>